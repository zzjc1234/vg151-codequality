name: Cross-Platform Build

on:
  push:
    # branches:
  pull_request:

jobs:
  macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install LLVM via Homebrew
        run: brew install llvm cmake
      - name: Build
        run: |
          ./build-cross-platform.sh -c -t Release
      - uses: actions/upload-artifact@v4
        with:
          name: macos-lib
          path: build/codequality/libcodequality.*

  deb:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y cmake build-essential

          sudo apt-get install -y clang-18     libclang-18-dev     llvm-18     llvm-18-dev     llvm-18-tools     libzstd-dev     zlib1g-dev     libedit-dev     libcurl4-openssl-dev     libxml2-dev
      - name: Build
        run: |
          ./build-cross-platform.sh -c -t Release
      - uses: actions/upload-artifact@v4
        with:
          name: deb-lib
          path: build/codequality/libcodequality.*

  redhat:
    runs-on: ubuntu-latest
    container:
      image: fedora:latest
      options: --user root
    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: |
          dnf -y update
          dnf -y install cmake make gcc-c++ clang clang-devel llvm llvm-devel \
            zlib-devel libedit-devel libxml2-devel zstd libcurl-devel
      - name: Build
        run: |
          ./build-cross-platform.sh -c -t Release
      - uses: actions/upload-artifact@v4
        with:
          name: rpm-lib
          path: build/codequality/libcodequality.*

  arch:
    runs-on: ubuntu-latest
    container:
      image: archlinux:latest
      options: --user root
    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: |
          pacman -Sy --noconfirm
          pacman -S --noconfirm cmake base-devel llvm clang zlib libedit libxml2 zstd curl
          pacman -S --noconfirm llvm-libs
      - name: Build
        run: ./build-cross-platform.sh -c -t Release
      - uses: actions/upload-artifact@v4
        with:
          name: arch-lib
          path: build/codequality/libcodequality.*

